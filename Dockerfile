# Confessional Agency Ecosystem (CAE) Docker Configuration # Production-ready deployment with GPU support FROM pytorch/pytorch:2.0.1-cuda11.7-cudnn8-devel # Set working directory WORKDIR /app # Install system dependencies RUN apt-get update && apt-get install -y \ git \ wget \ curl \ build-essential \ libsndfile1 \ ffmpeg \ libsm6 \ libxext6 \ libxrender-dev \ libgl1-mesa-glx \ && rm -rf /var/lib/apt/lists/* # Copy requirements and install Python dependencies COPY requirements.txt . RUN pip install --no-cache-dir -r requirements.txt # Copy CAE system files COPY unified_cae.py ./cae/ COPY configs/ ./configs/ COPY models/ ./models/ COPY examples/ ./examples/ COPY tests/ ./tests/ # Set environment variables ENV PYTHONPATH="/app:$PYTHONPATH" ENV CAE_CONFIG_PATH="/app/configs/cae_config.yaml" ENV CUDA_VISIBLE_DEVICES="0" ENV TRANSFORMERS_CACHE="/app/models" ENV HF_HOME="/app/models" # Create necessary directories RUN mkdir -p /app/logs /app/data /app/models # Set permissions RUN chmod +x /app/cae/*.py # Health check HEALTHCHECK --interval=30s --timeout=30s --start-period=5s --retries=3 \ CMD curl -f http://localhost:8000/health || exit 1 # Expose port for API EXPOSE 8000 # Default command CMD ["python", "-m", "cae.api.server"]
